<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.example.store.mapper.ProductMapper">

    <select id="selectProductList" resultType="org.example.store.vo.ProductCardVO">
        SELECT
            p.id,
            p.name,
            p.price,
            p.cover_img
        FROM product p
        WHERE p.status = 1

        <!-- 关键词搜索 -->
        <if test="keyword != null and keyword != ''">
            AND p.name LIKE CONCAT('%', #{keyword}, '%')
        </if>

        <!-- 排序逻辑 -->
        <choose>
            <when test="sort == 'price_asc'">
                ORDER BY p.price ASC
            </when>
            <when test="sort == 'price_desc'">
                ORDER BY p.price DESC
            </when>
            <otherwise>
                ORDER BY p.id DESC
            </otherwise>
        </choose>

        SELECT
        p.id,
        p.name,
        p.category_id,
        p.brand_id,
        p.description,
        p.cover_image,
        p.status,
        p.created_at,
        p.updated_at,
        b.name AS brand_name
        FROM product p
        LEFT JOIN brand b ON b.id = p.brand_id
        WHERE p.status = 1
        <if test="categoryId != null and categoryId != 0">
            AND p.category_id = #{categoryId}
        </if>
        <if test="keyword != null and keyword != ''">
            AND (
            p.name LIKE CONCAT('%', #{keyword}, '%')
            OR p.description LIKE CONCAT('%', #{keyword}, '%')
            OR b.name LIKE CONCAT('%', #{keyword}, '%')
            )
        </if>
        ORDER BY p.created_at DESC, p.id DESC
        LIMIT #{offset}, #{size}

    </select>

</mapper>
