<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="RAFCART - Multipurpose eCommerce HTML Template">
    <meta name="author" content="Programming Kit">
    <title>RAFCART - Multipurpose eCommerce HTML Template</title>
    <link rel="shortcut icon" href="assets/images/favicon.png" type="image/x-icon">

    <!-- all css -->  
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/jquery-ui.css">
    <link rel="stylesheet" href="assets/css/slick.css">
    <link rel="stylesheet" href="assets/css/line-awesome.css">
    <link rel="stylesheet" href="assets/css/nice-select.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
</head>

<body>

    <!-- Preloader -->
    <div class="preloader">
        <img src="assets/images/preloader.gif" alt="preloader">
    </div>

    <!-- top header -->
    <header class="home-2 d-none d-lg-block">
        <div class="container">
            <div class="d-flex align-items-center">
                <div class="logo">
                    <a href="index.html">
                        <img loading="lazy"  src="assets/images/svg/logo.svg" alt="logo">
                    </a>
                </div>

                <ul class="nav_bar flex-grow-1">
                    <li class="withsubs">
                        <a href="index.html">Home <span><i class="las la-angle-down"></i></span></a>
                        <ul class="subnav">
                            <li><a href="index.html">Home page </a></li>
                        </ul>
                    </li>
                    <li class="withsubs">
                        <a href="shop-list.html">Shop <span><i class="las la-angle-down"></i></span></a>
                        <ul class="subnav">
                            <li><a href="shop-list.html">List view </a></li>
                            <li><a href="shop-grid.html">Grid view</a></li>
                            
                            <li><a href="shopping-cart.html">Shopping cart</a></li>
                            <li><a href="product-view.html">Product view</a></li>
                        </ul>
                    </li>
                    <li class="withsubs">
                        <a href="shop-list.html">Pages <span><i class="las la-angle-down"></i></span></a>
                        <div class="subnav py-3 px-2 d-flex gx-4">
                            <div class="single_subnav">
                                <h5 class="text_lg ps-3 mb-2">Others pages</h5>
                                <ul>
                                    <li><a href="about-us.html">About us</a></li>
                                    <li><a href="contact-us.html">Contact us</a></li>

                                    <li><a href="track-order.html">Track order</a></li>
                                    <li><a href="faq.html">FAQ</a></li>
                                    <li><a href="404.html">404</a></li>
                                </ul>
                            </div>
                            <div class="single_subnav">
                                <h5 class="text_lg ps-3 mb-2">Account pages</h5>
                                <ul>
                                    <li><a href="account_linked.html">My Account</a></li>
                                    <li><a href="login.html">Login</a></li>
                                    <li><a href="register.html">Register</a></li>
                                    <li><a href="forgot-password.html">Forgot password</a></li>
                                </ul>
                            </div>
                            <div class="single_subnav">
                                <h5 class="text_lg ps-3 mb-2">Checkout page</h5>
                                <ul>
                                    <li><a href="checkout.html">Checkout</a></li>
                                    <li><a href="wish-list.html">Wishlist</a></li>
                                    <li><a href="order-completed.html">Order complete</a></li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <li><a href="contact-us.html">contact</a></li>
                    <li class="tophead_items ms-auto">
                        <div class="me-3">
                            <a class="text-semibold me-0" href="login.html">login</a><span class="text_xs">/</span><a
                                class="text-semibold" href="register.html">Register</a>
                        </div>
                    </li>
                </ul>

            </div>
        </div>
    </header>

    <!-- navbar -->
    <nav class="home-2">
        <div class="container">
            <div class="d-flex align-items-center justify-content-between">
                <a href="index.html" class="mobile_logo d-block d-lg-none">
                    <img loading="lazy"  src="assets/images/svg/logo-white.svg" alt="logo">
                </a>
                <div class="all_category otherpage d-none d-lg-block">
                    <div class="bars text-white d-flex align-items-center justify-content-center">
                                <span class="icon">
                                    <i class="las la-bars"></i>
                                </span>
                        <span class="icon_text">All categories</span>
                    </div>
                    <div class="sub_categories_wrp">
                        <div class="sub_categories">
                            <h5 class="d-block position-relative d-lg-none subcats_title">
                                All categories
                            </h5>
                            <a href="#" class="singlecats">
                                    <span class="img_wrp">
                                       <i class="las la-shoe-prints"></i>  
                                    </span>
                                <span class="txt">Shoes</span>
                            </a>

                            <div class="singlecats withsub">
                                    <span class="img_wrp">
                                        <i class="las la-male"></i>
                                    </span>
                                <span class="txt">Men</span>
                                <span class="wsicon"><i class="las la-angle-right"></i></span>
                                <div class="mega_menu">
                                    <div class="single_mega_menu">
                                        <div class="mega_menu_wrap">
                                            <h4>Hot sale</h4>
                                            <div class="mega_categories">
                                                <a href="#">Hoodies $ Sweatshirts</a>
                                                <a href="#">T-Shirt</a>
                                                <a href="#">Men’s Sets</a>
                                                <a href="#">Jacket</a>
                                                <a href="#">Shoes</a>
                                            </div>
                                        </div>
                                        <div class="mega_menu_wrap">
                                            <h4>Bottoms</h4>
                                            <div class="mega_categories">
                                                <a href="#">Casual Pants</a>
                                                <a href="#">Men’s Sleep & Lounge</a>
                                                <a href="#">Jeans</a>
                                                <a href="#">Shorts</a>
                                                <a href="#">Towel</a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="single_mega_menu">
                                        <div class="mega_menu_wrap">
                                            <h4>Outerwear $ Jackets</h4>
                                            <div class="mega_categories">
                                                <a href="#">Jacket</a>
                                                <a href="#">Sweaters</a>
                                                <a href="#">Casual Faux Leather</a>
                                                <a href="#">Parks</a>
                                                <a href="#">Jeans</a>
                                            </div>
                                        </div>
                                        <div class="mega_menu_wrap">
                                            <h4>Underwear & Loun</h4>
                                            <div class="mega_categories">
                                                <a href="#">Boxes</a>
                                                <a href="#">Berifs</a>
                                                <a href="#">Long Johns</a>
                                                <a href="#">Men’s Sleep & Lounge</a>
                                                <a href="#">Parks</a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="single_mega_menu">
                                        <div class="mega_menu_wrap">
                                            <h4>Accessories</h4>
                                            <div class="mega_categories">
                                                <a href="#">Scarves</a>
                                                <a href="#">Skullies & Beanies</a>
                                                <a href="#">Casual Faux Leather</a>
                                                <a href="#">Prescription Glasses</a>
                                                <a href="#">Belt</a>
                                            </div>
                                        </div>
                                        <div class="mega_menu_wrap">
                                            <h4>Novelty & Special</h4>
                                            <div class="mega_categories">
                                                <a href="#">Cosplay Costumes</a>
                                                <a href="#">Stage & Dance Wear</a>
                                                <a href="#">Exotic Apparel</a>
                                                <a href="#">Scarves</a>
                                                <a href="#">Men’s Sets</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="single_mega_menu brnd">
                                        <div class="mega_brands">
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-1.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-2.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-3.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-4.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-5.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-6.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-7.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-8.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-9.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-10.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-11.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-12.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-13.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-14.png" alt="brand">
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <a href="#" class="singlecats">
                                    <span class="img_wrp">
                                        <i class="las la-female"></i>
                                    </span>
                                <span class="txt">Women</span>
                            </a>
                            <a href="#" class="singlecats">
                                    <span class="img_wrp">
                                        <i class="las la-plug"></i>
                                    </span>
                                <span class="txt">Electronisc</span>
                            </a>
                            <a href="#" class="singlecats">
                                    <span class="img_wrp">
                                        <i class="las la-headphones"></i>
                                    </span>
                                <span class="txt">Headphones</span>
                            </a>
                            <a href="#" class="singlecats">
                                    <span class="img_wrp">
                                         <i class="icon-watch"></i>
                                    </span>
                                <span class="txt">Watches</span>
                            </a>
                            <div class="singlecats withsub">
                                    <span class="img_wrp">
                                         <i class="las la-desktop"></i>
                                    </span>
                                <span class="txt">Computer</span>
                                <span class="wsicon"><i class="las la-angle-right"></i></span>
                                <div class="mega_menu">
                                    <div class="single_mega_menu">
                                        <div class="mega_menu_wrap">
                                            <h4>Macbook</h4>
                                            <div class="mega_categories">
                                                <a href="#">Mackbook m1</a>
                                                <a href="#">Mackbook pro</a>
                                                <a href="#">Mackbook air</a>
                                                <a href="#">Mackbook 2015</a>
                                                <a href="#">Mackbook 2020</a>
                                            </div>
                                        </div>
                                        <div class="mega_menu_wrap">
                                            <h4>Laptop</h4>
                                            <div class="mega_categories">
                                                <a href="#">Razer</a>
                                                <a href="#">Hp Laptop</a>
                                                <a href="#">Dell Notebook</a>
                                                <a href="#">Asus</a>
                                                <a href="#">Lenovo</a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="single_mega_menu">
                                        <div class="mega_menu_wrap">
                                            <h4>Dasktop</h4>
                                            <div class="mega_categories">
                                                <a href="#">Brand Dasktop</a>
                                                <a href="#">All in one pc</a>
                                                <a href="#">Mini PC</a>
                                                <a href="#">Customize PC</a>
                                                <a href="#">Dasktop Accessories</a>
                                            </div>
                                        </div>
                                        <div class="mega_menu_wrap">
                                            <h4>Monitor</h4>
                                            <div class="mega_categories">
                                                <a href="#">Samsung</a>
                                                <a href="#">Philips</a>
                                                <a href="#">LG</a>
                                                <a href="#">HP</a>
                                                <a href="#">Xiaomi</a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="single_mega_menu">
                                        <div class="mega_menu_wrap">
                                            <h4>Accessories</h4>
                                            <div class="mega_categories">
                                                <a href="#">Dasktop Ram</a>
                                                <a href="#">Motherboard</a>
                                                <a href="#">SSD Card</a>
                                                <a href="#">Hard disk</a>
                                                <a href="#">Processor</a>
                                            </div>
                                        </div>
                                        <div class="mega_menu_wrap">
                                            <h4>Gaming</h4>
                                            <div class="mega_categories">
                                                <a href="#">Gaming console</a>
                                                <a href="#">Gaming Chair</a>
                                                <a href="#">Gaming Desk</a>
                                                <a href="#">Gaming Controller</a>
                                                <a href="#">Keyboard</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="single_mega_menu brnd">
                                        <div class="mega_brands">
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-1.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-2.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-3.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-4.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-5.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-6.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-7.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-8.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-9.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-10.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-11.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-12.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-13.png" alt="brand">
                                            </a>
                                            <a href="#" class="mega_brnd_img">
                                                <img loading="lazy"  src="assets/images/brand-14.png" alt="brand">
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <a href="#" class="singlecats">
                                    <span class="img_wrp">
                                        <i class="las la-mobile"></i>
                                    </span>
                                <span class="txt">Mobile</span>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="search_wrap d-none d-lg-block">
                    <div class="search d-flex">
                        <div class="search_category">
                            <select class="nice_select">
                                <option value="">Category</option>
                                <option value="">Brand</option>
                            </select>
                        </div>
                        <div class="search_input">
                            <input type="text" placeholder="Search product..." id="show_suggest">
                        </div>
                        <div class="search_subimt">
                            <button>
                                <span class="d-none d-sm-inline-block">Search</span>
                                <span class="d-sm-none d-inline-block"><i class="icon-search-left"></i></span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="header_icon d-flex align-items-center">
                    <a href="wish-list.html" class="icon_wrp text-center wishlist ms-0">
                                <span class="icon">
                                    <i class="icon-heart"></i>
                                </span>
                        <span class="icon_text">Wish List</span>
                        <span class="pops">0</span>
                    </a>
                    <div class="shopcart">
                        <a href="shopping-cart.html" class="icon_wrp text-center d-none d-lg-block">
                                    <span class="icon">
                                        <i class="icon-cart"></i>
                                    </span>
                            <span class="icon_text">Cart</span>
                            <span class="pops">0</span>
                        </a>
                        <div class="shopcart_dropdown">
                            <div class="cart_droptitle">
                                <h4 class="text_lg"><span class="mini-cart-total">0</span> Items</h4>
                            </div>
                            <div class="cartsdrop_wrap" id="mini-cart-items">
                                <div class="text-muted text-center py-3">Loading...</div>
                            </div>
                            <div class="d-flex justify-content-between align-items-center px-3 pb-2" id="mini-cart-pager" style="gap:8px;">
                                <button class="default_btn small rounded" id="mini-cart-prev" type="button" style="min-width:70px;">Prev</button>
                                <div class="text_xs text_p" id="mini-cart-pageinfo">1 / 1</div>
                                <button class="default_btn small rounded" id="mini-cart-next" type="button" style="min-width:70px;">Next</button>
                            </div>
                            <div class="total_cartdrop">
                                <h4 class="text_lg text-uppercase mb-0">Sub Total:</h4>
                                <h4 class="text_lg mb-0 ms-2">￥<span class="mini-cart-subtotal">0.00</span></h4>
                            </div>
                            <div class="cartdrop_footer d-flex mt-3">
                                <a href="shopping-cart.html" class="default_btn w-50 text_xs px-1">View Cart</a>
                                <a href="checkout.html" class="default_btn second ms-3 w-50 text_xs px-1">Checkout</a>
                            </div>
                        </div>
                    </div>
                    <div class="position-relative myacwrap">
                        <a href="javascript:void(0)" class="icon_wrp text-center myacc">
                                    <span class="icon">
                                       <i class="icon-user-line"></i>
                                    </span>
                            <span class="icon_text">Account</span>
                        </a>
                        <div class="myacc_cont">
                            <div class="ac_join">
                                <p>Welcome to RAFCART Shop</p>
                                <div class="account_btn d-flex justify-content-between">
                                   <a href="register.html" class="default_btn">Join</a>
                                    <a href="login.html" class="default_btn second">Sing in</a>
                                </div>
                            </div>
                            <div class="ac_links">
                                  <a href="account_linked.html" class="myac">
                                    <i class="lar la-id-card"></i>
                                    My Account
                                </a>
                               <a href="account_order_history.html">
                                    <i class="las la-gift"></i>
                                    My Order
                                </a>
                               <a href="wish-list.html">
                                    <i class="lar la-heart"></i>
                                    My Wishlist
                                </a>
                                <a href="shopping-cart.html">
                                     <i class="icon-cart"></i>
                                    My Cart
                                </a>
                                <a href="login.html">
                                    <i class="las la-power-off"></i>
                                    Log out
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </nav>

    <!-- mobile bottom bar -->
    <div class="mobile_bottombar d-block d-lg-none">
        <div class="header_icon">
            <a href="javascript:void(0)" class="icon_wrp text-center open_menu">
                        <span class="icon">
                            <i class="las la-bars"></i>
                        </span>
                <span class="icon_text">Menu</span>
            </a>
            <a href="javascript:void(0)" class="icon_wrp text-center open_category">
                        <span class="icon">
                           <i class="icon-list-ul"></i>
                        </span>
                <span class="icon_text">Categories</span>
            </a>
            <a href="javascript:void(0)" class="icon_wrp text-center" id="src_icon">
                        <span class="icon">
                           <i class="icon-search-left"></i>
                        </span>
                <span class="icon_text">Search</span>
            </a>
            <a href="javascript:void(0)" class="icon_wrp crt text-center" id="openCart">
                        <span class="icon">
                            <i class="icon-cart"></i>
                        </span>
                <span class="icon_text">Cart</span>
                <span class="pops">8</span>
            </a>
        </div>
    </div>

    <!-- mobile menu -->
    <div class="mobile_menwrap d-lg-none" id="mobile_menwrap">
        <div class="mobile_menu_2">
            <h5 class="mobile_title">
                Menu
                <span class="sidebarclose" id="menuclose">
                            <i class="las la-times"></i>
                        </span>
            </h5>
            <ul>
                <li class="withsub">
                    <a href="javascript:void(0)">
                        Home
                    </a>
                    <div class="submn">
                        <a href="index.html">Home </a>
                    </div>
                </li>

                <li class="withsub">
                    <a href="javascript:void(0)">
                        Shop
                    </a>
                    <div class="submn">
                        <a href="shop-list.html">List View</a>
                        <a href="shop-grid.html">Grid View</a>
                        <a href="wish-list.html">Wishlist</a>
                        <a href="shopping-cart.html">Shopping cart</a>
                        <a href="product-view.html">Product view</a>
                    </div>
                </li>
                <li class="withsub">
                    <a href="javascript:void(0)">
                        My Account
                    </a>
                    <div class="submn">
                        <a href="account_linked.html">My account</a>
                        <a href="login.html">Login</a>
                        <a href="register.html">Register</a>
                        <a href="forgot-password.html">Forgot password</a>
                    </div>
                </li>
                <li class="withsub">
                    <a href="javascript:void(0)">
                        Other pages
                    </a>
                    <div class="submn">
                        <a href="about-us.html">about us</a>
                        <a href="contact-us.html">Contact us</a>
                        <a href="track-order.html">Track order</a>
                        <a href="faq.html">FAQ</a>
                        <a href="404.html">404</a>
                        <a href="checkout.html">Checkout</a>
                        <a href="order-completed.html">Order complete</a>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <!--  mobile cart -->
    <div class="mobile_menwrap d-lg-none" id="mobileCart">
        <div class="mobile_cart_wrap d-flex flex-column">
            <h5 class="mobile_title">
                Cart
                <span class="sidebarclose" id="mobileCartClose">
                            <i class="las la-times"></i>
                        </span>
            </h5>
            <div class="px-3 py-3 flex-grow-1 d-flex flex-column">
                <div class="cart_droptitle">
                    <h4 class="text_lg">Total 0 Items</h4>
                </div>
                <div class="mt-auto">
                    <div class="total_cartdrop">
                        <h4 class="text_lg text-uppercase mb-0">Sub Total:</h4>
                        <h4 class="text_lg mb-0 ms-2">$0.00</h4>
                    </div>
                    <div class="cartdrop_footer mt-3 d-flex">
                        <a href="shopping-cart.html" class="default_btn w-50 text_xs px-1">View Cart</a>
                         <a href="checkout.html" class="default_btn second ms-3 w-50 text_xs px-1">Checkout</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- mobile searchbar -->
    <div class="mobile_search_bar">
        <div class="mobile_search_text">
            <p>What you are looking for?</p>
            <span class="close_mbsearch" id="close_mbsearch">
                        <i class="las la-times"></i>
                    </span>
        </div>
        <form>
            <input type="text" placeholder="search products...">
            <button>
                <i class="icon-search-left"></i>
            </button>
        </form>

        <div class="search_result_product">
            <a href="product-view.html" class="single_sresult_product">
                <div class="sresult_img">
                    <img loading="lazy"  src="assets/images/laptop-2.png" alt="product">
                </div>
                <div class="sresult_content">
                    <h4>HP Pavilion 15</h4>
                    <div class="price">
                        <span class="org_price">$45.00</span>
                        <span class="prev_price">$55.45</span>
                    </div>
                </div>
            </a>
            <a href="product-view.html" class="single_sresult_product">
                <div class="sresult_img">
                    <img loading="lazy"  src="assets/images/phone-1.png" alt="product">
                </div>
                <div class="sresult_content">
                    <h4>Xiaomi Note 7 Pro</h4>
                    <div class="price">
                        <span class="org_price">$45.00</span>
                        <span class="prev_price">$55.45</span>
                    </div>
                </div>
            </a>
        </div>
    </div>

    <!-- mobile category -->
    <div class="mobile_menwrap d-lg-none" id="mobile_catwrap">
        <div class="sub_categories">
            <h5 class="mobile_title">
                All categories
                <span class="sidebarclose" id="catclose">
                            <i class="las la-times"></i>
                        </span>
            </h5>

            <a href="#" class="singlecats">
                        <span class="img_wrp">
                           <i class="las la-shoe-prints"></i>  
                        </span>
                <span class="txt">Shoes</span>
            </a>

            <div class="singlecats withsub">
                        <span class="img_wrp">
                            <i class="las la-male"></i>
                        </span>
                <span class="txt">Men</span>
                <span class="wsicon"><i class="las la-angle-right"></i></span>
                <div class="mega_menu">
                    <div class="single_mega_menu">
                        <div class="mega_menu_wrap">
                            <h4>Hot sale</h4>
                            <div class="mega_categories">
                                <a href="#">Hoodies $ Sweatshirts</a>
                                <a href="#">T-Shirt</a>
                                <a href="#">Men’s Sets</a>
                                <a href="#">Jacket</a>
                                <a href="#">Shoes</a>
                            </div>
                        </div>
                        <div class="mega_menu_wrap">
                            <h4>Bottoms</h4>
                            <div class="mega_categories">
                                <a href="#">Casual Pants</a>
                                <a href="#">Men’s Sleep & Lounge</a>
                                <a href="#">Jeans</a>
                                <a href="#">Shorts</a>
                                <a href="#">Towel</a>
                            </div>
                        </div>
                    </div>

                    <div class="single_mega_menu">
                        <div class="mega_menu_wrap">
                            <h4>Outerwear $ Jackets</h4>
                            <div class="mega_categories">
                                <a href="#">Jacket</a>
                                <a href="#">Sweaters</a>
                                <a href="#">Casual Faux Leather</a>
                                <a href="#">Parks</a>
                                <a href="#">Jeans</a>
                            </div>
                        </div>
                        <div class="mega_menu_wrap">
                            <h4>Underwear & Loun</h4>
                            <div class="mega_categories">
                                <a href="#">Boxes</a>
                                <a href="#">Berifs</a>
                                <a href="#">Long Johns</a>
                                <a href="#">Men’s Sleep & Lounge</a>
                                <a href="#">Parks</a>
                            </div>
                        </div>
                    </div>

                    <div class="single_mega_menu">
                        <div class="mega_menu_wrap">
                            <h4>Accessories</h4>
                            <div class="mega_categories">
                                <a href="#">Scarves</a>
                                <a href="#">Skullies & Beanies</a>
                                <a href="#">Casual Faux Leather</a>
                                <a href="#">Prescription Glasses</a>
                                <a href="#">Belt</a>
                            </div>
                        </div>
                        <div class="mega_menu_wrap">
                            <h4>Novelty & Special</h4>
                            <div class="mega_categories">
                                <a href="#">Cosplay Costumes</a>
                                <a href="#">Stage & Dance Wear</a>
                                <a href="#">Exotic Apparel</a>
                                <a href="#">Scarves</a>
                                <a href="#">Men’s Sets</a>
                            </div>
                        </div>
                    </div>
                    <div class="single_mega_menu brnd">
                        <div class="mega_brands">
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-1.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-2.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-3.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-4.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-5.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-6.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-7.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-8.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-9.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-10.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-11.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-12.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-13.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-14.png" alt="brand">
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <a href="#" class="singlecats">
                        <span class="img_wrp">
                            <i class="las la-female"></i>
                        </span>
                <span class="txt">Women</span>
            </a>
            <a href="#" class="singlecats">
                        <span class="img_wrp">
                            <i class="las la-plug"></i>
                        </span>
                <span class="txt">Electronisc</span>
            </a>
            <a href="#" class="singlecats">
                        <span class="img_wrp">
                            <i class="las la-headphones"></i>
                        </span>
                <span class="txt">Headphones</span>
            </a>
            <a href="#" class="singlecats">
                        <span class="img_wrp">
                             <i class="icon-watch"></i>
                        </span>
                <span class="txt">Watches</span>
            </a>
            <div class="singlecats withsub">
                        <span class="img_wrp">
                             <i class="las la-desktop"></i>
                        </span>
                <span class="txt">Computer</span>
                <span class="wsicon"><i class="las la-angle-right"></i></span>
                <div class="mega_menu">
                    <div class="single_mega_menu">
                        <div class="mega_menu_wrap">
                            <h4>Macbook</h4>
                            <div class="mega_categories">
                                <a href="#">Mackbook m1</a>
                                <a href="#">Mackbook pro</a>
                                <a href="#">Mackbook air</a>
                                <a href="#">Mackbook 2015</a>
                                <a href="#">Mackbook 2020</a>
                            </div>
                        </div>
                        <div class="mega_menu_wrap">
                            <h4>Laptop</h4>
                            <div class="mega_categories">
                                <a href="#">Razer</a>
                                <a href="#">Hp Laptop</a>
                                <a href="#">Dell Notebook</a>
                                <a href="#">Asus</a>
                                <a href="#">Lenovo</a>
                            </div>
                        </div>
                    </div>

                    <div class="single_mega_menu">
                        <div class="mega_menu_wrap">
                            <h4>Dasktop</h4>
                            <div class="mega_categories">
                                <a href="#">Brand Dasktop</a>
                                <a href="#">All in one pc</a>
                                <a href="#">Mini PC</a>
                                <a href="#">Customize PC</a>
                                <a href="#">Dasktop Accessories</a>
                            </div>
                        </div>
                        <div class="mega_menu_wrap">
                            <h4>Monitor</h4>
                            <div class="mega_categories">
                                <a href="#">Samsung</a>
                                <a href="#">Philips</a>
                                <a href="#">LG</a>
                                <a href="#">HP</a>
                                <a href="#">Xiaomi</a>
                            </div>
                        </div>
                    </div>

                    <div class="single_mega_menu">
                        <div class="mega_menu_wrap">
                            <h4>Accessories</h4>
                            <div class="mega_categories">
                                <a href="#">Dasktop Ram</a>
                                <a href="#">Motherboard</a>
                                <a href="#">SSD Card</a>
                                <a href="#">Hard disk</a>
                                <a href="#">Processor</a>
                            </div>
                        </div>
                        <div class="mega_menu_wrap">
                            <h4>Gaming</h4>
                            <div class="mega_categories">
                                <a href="#">Gaming console</a>
                                <a href="#">Gaming Chair</a>
                                <a href="#">Gaming Desk</a>
                                <a href="#">Gaming Controller</a>
                                <a href="#">Keyboard</a>
                            </div>
                        </div>
                    </div>
                    <div class="single_mega_menu brnd">
                        <div class="mega_brands">
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-1.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-2.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-3.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-4.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-5.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-6.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-7.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-8.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-9.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-10.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-11.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-12.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-13.png" alt="brand">
                            </a>
                            <a href="#" class="mega_brnd_img">
                                <img loading="lazy"  src="assets/images/brand-14.png" alt="brand">
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <a href="#" class="singlecats">
                        <span class="img_wrp">
                            <i class="las la-mobile"></i>
                        </span>
                <span class="txt">Mobile</span>
            </a>
        </div>
    </div>

    <!-- breadcrumbs -->
    <div class="container">
        <div class="breadcrumbs">
            <a href="index.html"><i class="las la-home"></i></a>
            <a href="shop-grid.html">Shop</a>
            <a href="#" class="active" id="breadcrumb-title"> </a>
        </div>
    </div>

    <!-- product view -->
    <div class="product_view_wrap section_padding_b">
        <div class="container">
            <div class="row">
                <div class="col-lg-6">
                    <div class="product_view_slider">
                    </div>
                    <div class="product_viewslid_nav">
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="product_info_wrapper">
                        <div class="product_base_info">
                            <h1 id="product-name"> </h1>
                            <div class="rating">
                                <div class="d-flex align-items-center">
                                    <div class="rating_star" id="header-stars">
                                    </div>
                                    <p class="rating_count" id="header-review-count">（0 Reviews）</p>
                                </div>
                            </div>
                            <div class="product_other_info">
                                <p><span>Availability:</span><span class="text-green" id="product-stock">In Stock</span></p>
                                <p><span>Brand:</span><span id="product-brand"> </span></p>
                                <p><span>Category:</span><span id="product-category"> </span></p>
                                <p><span>SKU:</span><span id="product-sku"> </span></p>
                            </div>
                            <div class="price mt-3 mb-3 d-flex align-items-center">
                                <span class="prev_price ms-0" id="product-old-price">￥0.00</span>
                                <span class="org_price ms-2" id="product-price">￥0.00</span>
                                <div class="disc_tag ms-3" id="product-discount">-0%</div>
                            </div>
                            <div class="pd_dtails">
                                <p id="product-short-desc">...</p>
                            </div>
                            <div class="shop_filter border-bottom-0 pb-0" id="sku-selectors"></div>
                            <div class="cart_qnty ms-md-auto">
                                <p>Quantity</p>
                                <div class="d-flex align-items-center">
                                    <div class="cart_qty" data-min="1">
                                        <div class="cart_qnty_btn" id="btn-minus">
                                            <i class="las la-minus"></i>
                                        </div>
                                        <div class="cart_count" id="quantity-count">1</div>
                                        <div class="cart_qnty_btn" id="btn-plus">
                                            <i class="las la-plus"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="product_buttons">
                            <a href="#" class="default_btn small rounded me-sm-3 me-2 px-4"><i class="icon-cart me-2"></i> Add to Cart</a>
                            <a href="#" class="default_btn small rounded second border-none"><i class="icon-heart me-2"></i> Wishlist</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="product_view_tabs mt-4">
                <div class="pv_tab_buttons" class="spec_text">
                    <div class="pbt_single_btn active" data-target=".info">Product Info</div>
                    <div class="pbt_single_btn" data-target=".qna">Question & Answer</div>
                    <div class="pbt_single_btn" data-target=".review">Review<span id="review-tab-count">(0)</span></div>
                </div>

                <!-- Info -->
                <div class="pb_tab_content info active">
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="pbt_info_text" id="product-desc-content"></div>
                        </div>
                    </div>
                </div>

                <!-- QnA -->
                <div class="pb_tab_content qna">
                    <h4>Questions</h4>
                    <div id="qna-container"></div>

                    <div class="pbqna_form">
                        <form action="#">
                            <textarea placeholder="Type your question"></textarea>
                            <button class="default_btn rounded">Ask Question</button>
                        </form>
                    </div>
                </div>

                <!-- Review -->
                <div class="pb_tab_content review">
                    <div class="review_rating">
                        <div class="total_rating">
                            <div class="trating_number">
                                <span class="avrage" id="review-avg">0.0</span>
                                <span class="from">/5</span>
                            </div>
                        <div class="rating_star" id="review-avg-stars"></div>
                        <div class="trating_count" id="review-total-count">0 Ratings</div>
                    </div>
                    <div class="overall_rating" id="review-breakdown"></div>
                </div>

                <div class="review_header d-flex align-items-center justify-content-between">
                    <p class="m-0 text-semibold">Product Reviews</p>
                    <div class="review_filters">
                        <select class="nice_select js-review-filter">
                            <option value="latest_all">Latest</option>
                            <option value="oldest">Oldest</option>
                            <option value="latest_bad">Bad reviews</option>
                        </select>
                    </div>
                </div>

                <div class="tab-pane fade show active" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">
                    <div class="add_review_form" id="review-form-wrap"></div>

                    <div id="reviews-container"></div>
                </div>
            </div>
        </div>

    <!-- new arrive -->
    <section class="new_arrive section_padding_b">
        <div class="container">
            <div class="d-flex align-items-start justify-content-between">
                <h2 class="section_title_2">Related products</h2>
            </div>
            <div class="row gy-4" id="related-products-row">
                <!-- 相关商品 -->
            </div>
    </section>

    <!-- footer area -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4 mb-md-0">
                    <div class="row">
                        <div class="col-12 col-md-6 col-lg-12">
                            <div class="footer_logo">
                                <img loading="lazy"  src="assets/images/svg/logo.svg" alt="easy shop">
                            </div>
                            <div class="footet_text">
                                <p>Lorem ipsum, or lipsum as it is sometimes kno
                                    wn, is dummy text used in laying out print, gra
                                    phic or web designs the passage.</p>
                            </div>
                        </div>
                        <div class="col-12 col-md-6 col-lg-12">
                            <div class="footer_newslet">
                                <h4>Newsletter</h4>
                                <form class="footernews_form">
                                    <input type="text" placeholder="Your email address">
                                    <button type="submit" class="default_btn">Subscribe</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 mb-3 mb-md-0">
                    <div class="row">
                        <div class="col-6">
                            <div class="footer_menu">
                                <h4 class="footer_title">My Account</h4>
                                <a href="account_order_history.html">Orders</a>
                                <a href="wish-list.html">Wishlist</a>
                                <a href="track-order.html">Track Order</a>
                                <a href="account_linked.html">Manage Account</a>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="footer_menu">
                                <h4 class="footer_title">Information</h4>
                                <a href="about-us.html">About Us</a>
                                <a href="return-policy.html">Return Policy</a>
                                <a href="terms-condition.html">Terms & condition</a>
                                <a href="privacy-policy.html">Privacy Policy</a>
                                <a href="faq.html">FAQ</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="footer_download">
                        <div class="row">
                            <div class="col-lg-6 col-lg-12">
                                <h4 class="footer_title">Contact</h4>
                                <div class="footer_contact">
                                    <p>
                                        <span class="icn"><i class="las la-map-marker-alt"></i></span>

                                        7895 Dr New Albuquerue, NM 19800, <br> United
                                        States Of America
                                    </p>
                                    <p class="phn">
                                        <span class="icn"><i class="las la-phone"></i></span>
                                        +566 477 256, +566 254 575
                                    </p>
                                    <p class="eml">
                                        <span class="icn"><i class="lar la-envelope"></i></span>
                                        info@domain.com
                                    </p>
                                </div>
                            </div>
                            <div class="footer_social col-lg-6 col-lg-12">
                                <div class="footer_icon d-flex">
                                    <a href="#" class="facebook"><i class="lab la-facebook-f"></i></a>
                                    <a href="#" class="twitter"><i class="lab la-twitter"></i></a>
                                    <a href="#" class="instagram"><i class="lab la-instagram"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- copyright -->
    <div class="copyright_wrap">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="payment_method">
                        <img loading="lazy"  src="assets/images/payment-method.png" alt="payment method">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- all js -->
    <script src="assets/js/config.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/jquery-3.5.1.min.js"></script>
    <script src="assets/js/jquery-ui.min.js"></script>
    <script src="assets/js/slick.min.js"></script>
    <script src="assets/js/jquery.nice-select.min.js"></script>
    <script src="assets/js/app.js"></script>
    <script src="assets/js/minicart.js"></script>

<script>
let allSkus = [];
let currentProductId = null;
let reviewState = {
    filter: 'latest_all',
    page: 1,
    size: 10
}

$(document).ready(function () {
    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('id');

    if (!productId) {
        alert("错误：缺少商品 ID");
        window.location.href = "shop-grid.html";
        return;
    }

    currentProductId = productId;
    loadProductDetail(productId);
    $('.js-review-filter').niceSelect('update');
});

function safeDomId(prefix, value) {
    return `${prefix}-${String(value ?? '').trim().replace(/[^a-zA-Z0-9_-]/g, '_')}`;
}

function setStars($container, rating) {
    const r = Number(rating) || 0;
    const full = Math.floor(r);
    const half = (r - full) >= 0.5 ? 1 : 0;
    const empty = 5 - full - half;

    let html = '';
    for (let i = 0; i < full; i++) html += '<span><i class="las la-star"></i></span>';
    if (half) html += '<span><i class="las la-star-half-alt"></i></span>';
    for (let i = 0; i < empty; i++) html += '<span><i class="lar la-star"></i></span>';

    $container.html(html);
}

async function loadProductDetail(id) {
    try {
        const {data: result} = await fetchJson(`${API_BASE_URL}/products/${id}`);

        if (result && result.code === 200) {
            const product = result.data;
            allSkus = product.skus || [];

            renderBasicInfo(product);
            renderImages(product);
            renderSkuSelectors();

            if (allSkus.length > 0) {
                let defaultSku = allSkus.find(s => s.stock > 0);
                if (!defaultSku) defaultSku = allSkus[0];
                if(defaultSku.size) $(`#${safeDomId('size', defaultSku.size)}`).prop('checked', true);
                if(defaultSku.color) $(`#${safeDomId('color', defaultSku.color)}`).prop('checked', true);
            
            updatePriceAndStock(defaultSku);
            }


            renderProductInfo(product);

            renderReviewForm(id);
            bindAskQuestion(id);

            bindActionButtons(product);

            await Promise.allSettled([
                loadQna(id, product),
                loadReviews(id, product)
            ]);
            loadRelatedProducts(product);
        } else {
            alert("商品加载失败: " + (result?.message || "未知错误"));
        }
    } catch (err) {
        console.error(err);
    }
}

function renderBasicInfo(p) {
    $('#product-name').text(p.name || '');
    $('#breadcrumb-title').text(p.name || '');
    document.title = (p.name ? `${p.name} - Shop` : 'Product view');
    $('#product-short-desc').text(p.shortDescription || p.description || "暂无描述");
    $('#product-brand').text(p.brandName || '无');
    $('#product-category').text(p.categoryName || '无');
    $('#product-sku').text(p.skuCode || (allSkus[0]?.skuCode ?? ''));

    const stockText = (allSkus[0] && typeof allSkus[0].stock === 'number')
        ? (allSkus[0].stock > 0 ? `有货 (剩余 ${allSkus[0].stock})` : '暂时缺货')
        : '—';
    $('#product-stock').text(stockText);

    const avg = p.avgRating ?? p.rating ?? 0;
    const cnt = p.reviewCount ?? p.ratingCount ?? 0;
    setStars($('#header-stars'), avg);
    $('#header-review-count').text(`（${cnt} Reviews）`);
}

function collectImages(p) {
    const arr = [].concat(p.images || []).concat(p.detailImages || []).concat(p.imageList || []).filter(Boolean);
    if (p.coverImage) arr.unshift(p.coverImage);
    return [...new Set(arr)];
}

function reinitSlick() {
    const $main = $('.product_view_slider');
    const $nav = $('.product_viewslid_nav');
    if ($main.hasClass('slick-initialized')) $main.slick('unslick');
    if ($nav.hasClass('slick-initialized')) $nav.slick('unslick');
    $main.slick({ slidesToShow: 1, slidesToScroll: 1, arrows: false, fade: true, asNavFor: '.product_viewslid_nav', infinite: false });
    $nav.slick({ slidesToShow: 5, slidesToScroll: 1, prevArrow: '<button type="button" class="slick-prev"><i class="las la-angle-left"></i></button>', nextArrow: '<button type="button" class="slick-next"><i class="las la-angle-right"></i></button>', asNavFor: '.product_view_slider', focusOnSelect: true, centerMode: false, centerPadding: '0px', infinite: false, responsive: [{ breakpoint: 576, settings: { slidesToShow: 3 } }] });
}

function renderImages(p) {
    const imgs = collectImages(p);
    const images = imgs.length ? imgs : ['assets/images/product1.jpg'];
    const mainHtml = images.map(src => `<div class="single_viewslider"><img loading="lazy" src="${src}" alt="${p.name || 'product'}"></div>`).join('');
    const navHtml = images.map(src => `<div class="single_viewslid_nav"><img loading="lazy" src="${src}" alt="${p.name || 'thumb'}"></div>`).join('');
    $('.product_view_slider').html(mainHtml);
    $('.product_viewslid_nav').html(navHtml);
    reinitSlick();
}

function renderSkuSelectors() {
    const $filter = $('#sku-selectors');
    $filter.empty();
    const sizes = [...new Set(allSkus.map(s => s.size).filter(Boolean))];
    const colors = [...new Set(allSkus.map(s => s.color).filter(Boolean))];

    if (sizes.length > 0) {
        let sizeHtml = `<div class="size_selector mb-3"><h5>Size</h5><div class="d-flex align-items-center flex-wrap">`;
        sizes.forEach((size, idx) => {
            const checked = idx === 0 ? 'checked' : '';
            const id = safeDomId('size', size);
            sizeHtml += `<div class="single_size_opt ms-2 mt-2"><input type="radio" hidden name="size" class="size_inp sku_inp" id="${id}" value="${String(size)}" ${checked}><label for="${id}">${String(size)}</label></div>`;
        });
        sizeHtml += `</div></div>`;
        $filter.append(sizeHtml);
    }
    if (colors.length > 0) {
        let colorHtml = `<div class="size_selector color_selector mb-3"><h5>Color</h5><div class="d-flex align-items-center flex-wrap">`;
        colors.forEach((color, idx) => {
            const checked = idx === 0 ? 'checked' : '';
            const id = safeDomId('color', color);
            const bgStyle = `background-color: ${String(color)}; border: 1px solid #ddd;`;
            colorHtml += `<div class="single_size_opt ms-2 mt-2"><input type="radio" hidden name="color" class="size_inp sku_inp" id="${id}" value="${String(color)}" ${checked}><label for="${id}" style="${bgStyle}" title="${String(color)}"></label></div>`;
        });
        colorHtml += `</div></div>`;
        $filter.append(colorHtml);
    }
    $('.sku_inp').off('change').on('change', matchSku);
    matchSku();
}

function matchSku() {
    const selectedSize = $('input[name="size"]:checked').val();
    const selectedColor = $('input[name="color"]:checked').val();
    const sku = allSkus.find(s => (!selectedSize || s.size === selectedSize) && (!selectedColor || s.color === selectedColor));
    if (sku) { updatePriceAndStock(sku); } else { $('#product-stock').text("缺货").removeClass('text-green').addClass('text-danger'); $('.product_buttons .default_btn').addClass('disabled'); }
}

function updatePriceAndStock(sku) {
    const price = sku?.price ?? 0;
    const original = sku?.originalPrice;
    $('#product-price, .org_price').text('￥' + price);
    if (original != null && original !== '' && Number(original) > Number(price)) { $('#product-old-price, .prev_price').text('￥' + original); $('#product-discount').text(`-${Math.round((1 - (Number(price) / Number(original))) * 100)}%`).show(); } else { $('#product-old-price, .prev_price').text(''); $('#product-discount').hide(); }
    if (sku && typeof sku.stock === 'number' && sku.stock > 0) { $('#product-stock').text(`有货 (剩余 ${sku.stock})`).removeClass('text-danger').addClass('text-green'); $('.product_buttons .default_btn').removeClass('disabled'); } else { $('#product-stock').text("暂时缺货").removeClass('text-green').addClass('text-danger'); }
    if (sku?.skuCode) $('#product-sku').text(sku.skuCode);
}

function renderProductInfo(p) {
    const $box = $('#product-desc-content');
    const html = p.detailHtml || p.detail || p.longDescription || p.description || '';
    if (html && /<[^>]+>/.test(html)) { $box.html(html); } else { $box.text(html || '暂无商品详情'); }
    const specs = p.specs || p.specifications || p.attributes || [];
    if (Array.isArray(specs) && specs.length) {
        const rows = specs.map(it => { const k = it.name ?? it.key ?? it.attrName ?? ''; const v = it.value ?? it.attrValue ?? ''; return `<tr><td style="width: 180px;">${k}</td><td>${v}</td></tr>`; }).join('');
        $box.append(`<div class="mt-4"><h5 class="mb-2">Specifications</h5><div class="table-responsive"><table class="table table-bordered m-0"><tbody>${rows}</tbody></table></div></div>`);
    }
}

function bindAskQuestion(productId) {
    const $form = $('.pb_tab_content.qna .pbqna_form form');
    const $textarea = $form.find('textarea');

    $form.off('submit').on('submit', async function (e) {
        e.preventDefault();
        const content = ($textarea.val() || '').trim();
        if (!content) {
            alert("请输入问题内容");
            return;
        }

        const $btn = $(this).find('button');
        $btn.prop('disabled', true);

        try {
            const { data } = await fetchJson(`${API_BASE_URL}/products/${productId}/questions`, {
                method: 'POST',
                body: JSON.stringify({ content: content })
            });

            if (data && (data.code === 200 || data.success)) {
                $textarea.val('');
                loadQna(productId, null);
                alert("提问已提交！");
            } else {
                alert('提交失败：' + (data?.msg || data?.message || '请先登录'));
            }
        } catch (e) {
            console.error(e);
            alert("提交失败：网络请求错误");
        } finally {
            $btn.prop('disabled', false);
        }
    });
}

function renderReviewForm(productId) {
    const $wrap = $('#review-form-wrap');
    if (!$wrap.length) return;

    $wrap.html(`
        <div class="pbqna_form" style="margin-top: 16px;">
          <form id="review-form" action="#">
            <div class="d-flex align-items-center mb-2" style="gap:12px;">
              <span class="text-semibold">评分：</span>
              <input id="review-rating" type="range" min="1" max="5" step="1" value="5" style="width:180px;">
              <div class="rating_star" id="review-rating-stars"></div>
              <span id="review-rating-num">5</span>
            </div>
            <textarea id="review-content" placeholder="Write your review... (optional)"></textarea>
            <button class="default_btn rounded">Submit Review</button>
          </form>
        </div>
    `);

    setStars($('#review-rating-stars'), 5);

    $('#review-rating').off('input').on('input', function () {
        const v = Number($(this).val() || 5);
        $('#review-rating-num').text(v);
        setStars($('#review-rating-stars'), v);
    });

    $('#review-form').off('submit').on('submit', async function (e) {
        e.preventDefault();
        const rating = Number($('#review-rating').val() || 5);
        const content = ($('#review-content').val() || '').trim();

        const $btn = $(this).find('button');
        $btn.prop('disabled', true);

        try {
            const { data } = await fetchJson(`${API_BASE_URL}/products/${productId}/reviews`, {
                method: 'POST',
                body: JSON.stringify({ productId, rating, content })
            });

            if (data && data.code === 200) {
                $('#review-content').val('');
                await loadReviews(productId, null);
                alert("评论发表成功！");
            } else {
                alert('提交失败：' + (data?.msg || data?.message || '未知错误'));
            }
        } catch (err) {
            console.error(err);
            alert('提交失败：网络错误');
        } finally {
            $btn.prop('disabled', false);
        }
    });

}

function bindActionButtons(product) {
        const $cartBtn = $('.product_buttons .default_btn:first');
        $cartBtn.off('click').on('click', async function (e) {
            e.preventDefault();

            const selectedSize = $('input[name="size"]:checked').val();
            const selectedColor = $('input[name="color"]:checked').val();

            const targetSku = allSkus.find(s =>
                (!selectedSize || s.size === selectedSize) &&
                (!selectedColor || s.color === selectedColor)
            );

            if (!targetSku) {
                alert("请选择有效的商品规格（颜色/尺寸）");
                return;
            }
            if (targetSku.stock <= 0) {
                alert("该规格暂时缺货");
                return;
            }

            const quantity = parseInt($('#quantity-count').text()) || 1;

            try {
                const { data } = await fetchJson(`${API_BASE_URL}/cart/add`, {
                    method: 'POST',
                    body: JSON.stringify({ skuId: targetSku.id, quantity })
                });

                if (data && data.code === 200) {
                    alert("成功加入购物车！");
                    await window.updateHeaderBadges?.();
                    window.dispatchEvent(new Event('cart:changed'));
                }
                else alert(data?.msg || "加入购物车失败，请先登录");
            } catch (err) {
                console.error(err);
                alert("加入购物车失败：网络错误");
            }
        })

        const $wishBtn = $('.product_buttons .default_btn.second');
        $wishBtn.off('click').on('click', async function (e) {
            e.preventDefault();

            try {
                const { data } = await fetchJson(`${API_BASE_URL}/wishlist/add`, {
                    method: 'POST',
                    body: JSON.stringify({ productId: product.id })
                });

                if (data && data.code === 200) {
                    alert("已添加到收藏夹");
                    await window.updateHeaderBadges?.();
                    window.dispatchEvent(new Event('wishlist:changed'));
                }
                else alert(data?.msg || "收藏失败，请先登录");
            } catch (err) {
                console.error(err);
                alert("收藏失败：网络错误");
            }
        });
    }

// QnA
async function loadQna(productId, productFallback) {
    const $container = $('#qna-container');
    $container.html('<p class="text-muted">加载提问中...</p>');

    const candidates = [
        `${API_BASE_URL}/products/${productId}/questions`,
        `${API_BASE_URL}/questions?productId=${productId}`
    ];

    let list = [];
    if (Array.isArray(productFallback?.reviews)) {
        list = productFallback.reviews;
    } else {
    for (const url of candidates) {
        try {
            const { data } = await fetchJson(url);
            if (data && data.code === 200) {
            const payload = data.data;
            list = Array.isArray(payload) ? payload : (payload?.records || []);
            break;
            }
        } catch (e) {}
  }
}


    if (!list.length) {
        $container.html('<p class="text-muted">暂无提问</p>');
        return;
    }

    $container.html(list.map(q => {
        const question = q.content ?? q.question ?? '';
        const answer = q.answer ?? q.reply ?? '';
        const time = q.createTime ?? q.createdAt ?? '';
        return `
            <div class="border rounded p-3 mb-3">
                <p class="m-0"><strong>Q:</strong> ${question}</p>
                ${answer ? `<p class="m-0 mt-2"><strong>A:</strong> ${answer}</p>` : `<p class="m-0 mt-2 text-muted">等待回复</p>`}
                ${time ? `<p class="m-0 mt-2 text-muted small">${time}</p>` : ''}
            </div>
        `;
    }).join(''));
}

// 评论
$('.js-review-filter').off('change').on('change', function () {
  reviewState.filter = $(this).val();
  reviewState.page = 1;
  if (!currentProductId) return;
  loadReviews(currentProductId, null);
});

async function loadReviews(productId, productFallback) {
    const $container = $('#reviews-container');
    $container.html('<p class="text-muted">加载评论中...</p>');

    const filter = reviewState.filter;
    const badOnly = filter === 'latest_bad';
    const sort = filter === 'oldest' ? 'oldest' : 'latest';
    const url = `${API_BASE_URL}/products/${productId}/reviews?sort=${sort}&badOnly=${badOnly}&page=${reviewState.page}&size=${reviewState.size}`;


    let list = [];
    try {
        const { data } = await fetchJson(url);
        if (data && data.code === 200) {
            const payload = data.data;
            list = Array.isArray(payload) ? payload : (payload?.records || []);

        }
    } catch (e) {console.error(e);}
    if ((!list || list.length === 0) && Array.isArray(productFallback?.reviews)) {
        list = productFallback.reviews;
    }

    const count = list.length;
    $('#review-tab-count').text(`(${count})`);
    $('#header-review-count').text(`（${count} Reviews）`);

    const scores = list.map(r => Number(r.rating ?? r.score ?? 0));
    const avg = scores.length ? (scores.reduce((a, b) => a + b, 0) / scores.length) : 0;
    
    setStars($('#header-stars'), avg);
    $('.total_rating .avrage').text(avg ? avg.toFixed(1) : '0.0');
    $('#review-avg').text(avg ? avg.toFixed(1) : '0.0');
    $('.total_rating .trating_count').text(`${count} Ratings`);
    $('#review-total-count').text(`${count} Ratings`);
    setStars($('#review-avg-stars'), avg);

    // 星级分布
    const dist = [0,0,0,0,0];
    scores.forEach(s => dist[Math.min(5, Math.max(1, Math.round(s))) - 1]++);
    const breakdownHtml = [5,4,3,2,1].map(star => {
        const c = dist[star-1];
        const pct = count ? Math.round((c / count) * 100) : 0;
        const $tmp = $('<div></div>');
        setStars($tmp, star);
        return `
            <div class="single_ovrating d-flex align-items-center">
                <div class="rating_star">${$tmp.html()}</div>
                <div class="rating_pbox"><span style="width:${pct}%;"></span></div>
                <p class="rating_count">${c}</p>
            </div>
        `;
    }).join('');
    $('#review-breakdown').html(breakdownHtml);

    if (count === 0) {
        $container.html('<p class="text-muted">暂无评论</p>');
    } else {
        $container.html(list.map(r => {
            const user = r.userName || '用户';
            const time = r.createTime || r.createdAt || '';
            const content = r.content || '';
            const rating = Number(r.rating || 5);
            const $tmp = $('<div></div>');
            setStars($tmp, rating);
            return `
                <div class="border rounded p-3 mb-3">
                    <div class="d-flex align-items-center justify-content-between">
                        <p class="m-0 text-semibold">${user}</p>
                        ${time ? `<p class="m-0 text-muted small">${time}</p>` : ''}
                    </div>
                    <div class="rating_star mt-1">${$tmp.html()}</div>
                    <p class="m-0 mt-2">${content}</p>
                </div>
            `;
        }).join(''));
    }
}

// 相关商品
async function loadRelatedProducts(product) {
    const container = document.getElementById("related-products-row");
    if (!container) return;

    container.innerHTML = `<div class="col-12 text-muted">加载相关商品中...</div>`;

    const query = {
        page: 1,
        size: 8,
        categoryId: product.categoryId,
        sort: "new"
    };

    try {
        const { data: result } = await fetchJson(`${API_BASE_URL}/products/list`, {
            method: "POST",
            body: JSON.stringify(query)
        });

        if (result && result.code === 200) {
            const list = (result.data.records || [])
                .filter(p => p.id !== product.id)
                .slice(0, 4);

            if (list.length === 0) {
                container.innerHTML = `<div class="col-12 text-muted">暂无相关商品</div>`;
                return;
            }

            container.innerHTML = list.map(p => {
                const img = p.coverImage || 'assets/images/product1.jpg';
                return `
                <div class="col-lg-3 col-sm-6">
                    <div class="single_new_arrive">
                        <div class="sna_img">
                            <a href="product-view.html?id=${p.id}">
                                <img class="prd_img" src="${img}" alt="${p.name}">
                            </a>
                        </div>
                        <div class="sna_content">
                            <a href="product-view.html?id=${p.id}">
                                <h4>${p.name}</h4>
                            </a>
                            <div class="ratprice">
                                <div class="price">
                                    <span class="org_price">￥${p.price}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                `;
            }).join("");
        } else {
            container.innerHTML = `<div class="col-12 text-muted">暂无相关商品</div>`;
        }
    } catch (e) {
        console.error(e);
        container.innerHTML = `<div class="col-12 text-danger">加载失败</div>`;
    }
}

</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const minusBtn = document.getElementById('btn-minus');
  const plusBtn = document.getElementById('btn-plus');
  const countEl = document.getElementById('quantity-count');

  if (!countEl) return;

  const min = 1;
  const getCount = () => parseInt(countEl.textContent, 10) || min;
  const setCount = (v) => { countEl.textContent = String(v); };

  minusBtn.addEventListener('click', () => {
    const cur = getCount();
    if (cur > min) setCount(cur - 1);
  });

  plusBtn.addEventListener('click', () => {
    setCount(getCount() + 1);
  });

  window.getCurrentQuantity = () => getCount();
});
</script>

<script>
$(function () {
  function goSearch() {
    const kw = ($('#show_suggest').val() || '').trim();
    const url = kw
      ? `shop-grid.html?keyword=${encodeURIComponent(kw)}`
      : `shop-grid.html`;
    window.location.href = url;
  }

  // 点击
  $('.search_subimt button').off('click._search').on('click._search', function (e) {
    e.preventDefault();
    goSearch();
  });

  // 回车
  $('#show_suggest').off('keydown._search').on('keydown._search', function (e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      goSearch();
    }
  });
});
</script>

</body>

</html>